# BMC Ketones Chapter

Last Modified: 3/15/2016  
Updated by Kevin Lesniewicz  
Original Developer — Bharat Battu  
Original Designer — Frank LeClair  

Latest Version Online:  
English: http://demo.wgbhdigital.org/bmc/ketones2/  
Spanish: http://demo.wgbhdigital.org/bmc/ketones2/spanish.html

### Overview

This HTML5 Canvas project contains all content for both ENGLISH and SPANISH versions of this e-book chapter. One .xfl project and one set of code manages both language versions. 


The .xfl project file (**xfl/ketones_www.xfl**) is the main point of entry to modifying and building this project. This project and its xfl were created using Adobe Flash Professional CC 2014. The project is an "HTML5 Canvas" type project.

As this is an "HTML5 Canvas" project that is built and exported in Flash CC... there is lots of code within the .xfl project timeline. Rememeber, it is all **JAVASCRIPT... on the Flash timeline!**. To get a sense of where there are pieces of code throughout the .xfl project, open the Actions panel within Flash Pro, and look at the left heirarchy of frames and symbols that contain code.

As changes are made to the .xfl file, re-publish in Flash Pro via File-->Publish. This incorporates the latest changes into the auto-generated .js file **ketones_www.js**, which is needed for the exported project to work. File ketones_www.html is also auto-generated but can be ignored. This project has its own custom **index.html** file that incorporates the additional code needed for this project to work (additional .js includes, separate sound loading, css, etc).

On-screen narration text is not part of the .xfl or the CreateJS canvas. It is rendered into a separate P element on the DOM within index.html.  index.css handles its posiitioning and sizing. storytext.js handles its content and changing across screens (see functions change_storytext and read_storytext).

### TIPS
Have the developer console open in browser, there are many console.log statements throughout the .js code in index.js, storytext.js, and the .xfl timeline that will be helpful.

Remember: though you're building in Flash and using a Flash timeline, the exported project is a CreateJS HTML5 interactive. So, **frame numbers start with 0, not 1**. 

Essentially, the entire interactive is contained within a single CreateJS Container: **exportRoot**. This is your entry to accessing your timeline symbols and frames via code. Make sure to give a movieclip symbol an instance name if you want to be able to access it via code. Example: a movieclip with instance name *screen2* will be accessible via code (when the main timeline (exportRoot) is at that frame where the screen2 mc exists) using syntax: exportRoot.screen2

##### Previous/Next Screen:
Screen to screen navigation (changing to and from different frames on the main timeline) is handled  via code at frame 1 on the *btn_code* layer (in UI group). There are two buttons (for previous/next screen), and each is hooked up to a single function for prev scene and next scene (btn_prev_clicked, btn_next_clicked). These event listener functions check the label of the current frame for exportRoot, and change frames accordingly.  Different screens of the ebook are on different frames of the main timeline with distinct labels. So, to jump from the titlescreen to screen 2:  exportRoot.gotoAndStop("screen2")


### Dependencies
* ketones_www.js  (generated code from published Flash .xfl project)
* index.js (custom code that sets the LANGUAGE based on url, initiates the CreateJS Stage and preloader, loads and plays sound assets, etc.)
* index.css: handles font referencing, and general positioning/resizing of the **p** element that displays per-screen text on the DOM, above and outside of the Canvas. (p id storytxt in index.html)
* storytext.js (defines the screen-specific text for both languages, has code used by .xfl for changing text on screen, swapping to lang-specific frames within MCs)
* easeljs 0.7.1.min.js
* tweenjs-0.5.1.min.js
* movieclip-0.7.1.min.js (plugin that comes with easeljs)
* preloadjs-0.4.1.min.js
* soundjs-0.5.2.min.js



### Testing
File **index.html** needs to be opened within a http server environment. Upload to a web server (files listed under Deployment), or run a local http server on your machine. A simple way to do this in OS X is to open Terminal, cd into this project's folder on your machine, and run:

python -m SimpleHTTPServer

Then, that folder is hosted at **http://localhost:8000**  (default page to open is index.html)

English is the default language. To see the Spanish version, navigate to spanish.html instead of index.html.


### Deployment
Only the following files and folders need to be uploaded to a webserver for viewing online:

* index.css
* index.html
* spanish.html
* index.js
* jquery-1.8.2.min.js
* ketones_www.js  (generated by Flash)
* OpenSans-ExtraBold.ttf
* OpenSans-Regular.ttf
* storytext.js
* /createjs
* /images
* /snd_en
* /snd_es
* /snd_sfx

### About Dual Languages

1) Each language has separate narrator audio files in their own respective folders, and the preload process in index.js is set to adjust the path to these files based on the value of global var LANG . English narrator audio is in folder /snd_en. Spanish narrator audio is in folder /snd_es.  Sound effect audio files are universal, so are in a separate folder that is loaded for either language:  /snd_sfx.

2) These movieclip symbols in the .xfl library have language-specific content at their "en" and "es" labelled frames on their respective timelines. These movieclips call function changeSymbolToLang (defined in storytext.js) whenever they are instantiated at their frame0. Each MC passes itself into funct. changeSymbolToLang, which then has the passed MC switch to the labelled frame defined by global var LANG .

* desc_txt_zach
* desc_txt_kara
* weakness_symptom
* urinating_symptom
* vomiting_symptom
* heavybreathing_symptom
* dehydration_symptom
* screen15_labels
* screen14_labels
* screen13_labels
* better_text
* ketone_meter
* screen10_organLabels
* screen9_organLabels
* fatty_acid
* screen8_organLabels
* screen4_organLabels
* screen6_organLabels
* screen1_titletxt